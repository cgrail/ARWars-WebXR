<!DOCTYPE html>
<html lang="en">

<head>
    <title>AR Wars</title>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style>
        body {
            background-color: black;
        }
    </style>
</head>

<body>

    <script src="//cdnjs.cloudflare.com/ajax/libs/tween.js/16.3.5/Tween.min.js"></script>
    <script type="module">

        import { initAR } from './lib/ARHelper.js';

        const { THREE, scene, camera, renderer, controller } = initAR(render, onSelect);

        function onSelect() {
            const geometry = new THREE.BoxGeometry(0.03, 0.03, 2);
            const material = new THREE.MeshBasicMaterial({
                color: "red"
            });
            const laser = new THREE.Mesh(geometry, material);
            var startPosition = new THREE.Vector3(0, -0.1, -0.5).applyMatrix4(controller.matrixWorld);
            laser.position.copy(startPosition);
            laser.quaternion.setFromRotationMatrix(controller.matrixWorld);
            const endPosition = new THREE.Vector3(0, -0.1, -3).applyMatrix4(controller.matrixWorld);
            const tween = new TWEEN.Tween(startPosition).to(endPosition, 2000);
            tween.onUpdate(() => {
                laser.position.x = startPosition.x;
                laser.position.y = startPosition.y;
                laser.position.z = startPosition.z;
                // const laserBox = new THREE.Box3().setFromObject(laser);
                // const tieFighterBox = new THREE.Box3().setFromObject(this.fighter);
                // if (tieFighterBox.intersectsBox(laserBox)) {
                //     scene.remove(laser);
                //     this.assets.explode(scene);
                //     this.assets.playExplosionSound();
                //     this.spawnFighter();
                //     tween.stop();
                // }
            });
            tween.start();
            tween.onComplete(() => {
                scene.remove(laser);
            });
            scene.add(laser);
        }

        function render(timestamp, frame) {
            TWEEN.update();
            renderer.render(scene, camera);
        }

    </script>
</body>

</html>